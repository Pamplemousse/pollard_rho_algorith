EXE=pollard

CFLAGS=-std=c11 -Wall -Wextra -Wno-unused-result -g -pg -no-pie
CPPFLAGS=-Iinclude -DDEBUG
LDFLAGS=-lgmp -lm

.PHONY: all clean test help


all: clean build

build:
	$(MAKE) $(EXE)

$(EXE): main.o distinguished_points.o equation_solver.o collision_distinguished_points.o iteration_r_adding_walks.o
	$(CC) $(CFLAGS) -o $@ $^ $(LDFLAGS)

main.o: main.c include/main.h
	$(CC) $(CFLAGS) $(CPPFLAGS) -c $<

distinguished_points.o: distinguished_points.c include/distinguished_points.h
	$(CC) $(CFLAGS) $(CPPFLAGS) -c $<

equation_solver.o: equation_solver.c include/equation_solver.h
	$(CC) $(CFLAGS) $(CPPFLAGS) -c $<

collision_floyd.o: collision_floyd.c include/collision.h
	$(CC) $(CFLAGS) $(CPPFLAGS) -c $<

collision_distinguished_points.o: collision_distinguished_points.c include/distinguished_points.h include/collision.h
	$(CC) $(CFLAGS) $(CPPFLAGS) -c $<

iteration_basic.o: iteration_basic.c include/iteration.h
	$(CC) $(CFLAGS) $(CPPFLAGS) -c $<

iteration_r_adding_walks.o: iteration_r_adding_walks.c include/iteration.h
	$(CC) $(CFLAGS) $(CPPFLAGS) -c $<

clean:
	@rm -f *.o $(EXE)
	@rm -f gmon.out
	@rm -f temp-plot.html
	@cd test && $(MAKE) clean

test:
	$(MAKE)
	@cd test && $(MAKE)

help:
	@echo "Usage:"
	@echo -e "  make [all]\t\tClean then build"
	@echo -e "  make build\t\tBuild the executable"
	@echo -e "  make clean\t\tRemove all files generated by make"
	@echo -e "  make help\t\tDisplay this help"
